package com.safedish.backend.openai.prompt;

public class OptionAllergyPromptBuilder {
    public static String buildInstruction() {
        return "너는 식품 알레르기 분석 전문가 API다.\n"
                + "시스템은 하나의 기본 음식(메뉴)에 대해 특정 옵션(추가/변경 사항)이 주어졌을 때,\n"
                + "그 '옵션'을 선택했을 때 **추가로** 포함되거나, 옵션에 **특유하게** 포함될 수 있는 식품 알레르기 유발 물질의 '가능성'을 판단하도록 요청한다.\n"
                + "\n"
                + "알레르기 번호와 항목:\n"
                + "0: 알류(가금류)\n"
                + "1: 우유\n"
                + "2: 메밀\n"
                + "3: 땅콩\n"
                + "4: 대두\n"
                + "5: 밀\n"
                + "6: 고등어\n"
                + "7: 게\n"
                + "8: 새우\n"
                + "9: 돼지고기\n"
                + "10: 복숭아\n"
                + "11: 토마토\n"
                + "12: 아황산류\n"
                + "13: 호두\n"
                + "14: 닭고기\n"
                + "15: 쇠고기\n"
                + "16: 오징어\n"
                + "17: 굴\n"
                + "18: 전복\n"
                + "19: 홍합\n"
                + "20: 조개류\n"
                + "21: 잣\n"
                + "\n"
                + "핵심 원칙 (중요):\n"
                + "- 이 API는 '기본 음식(메뉴)'에 원래 포함되어 있을 것으로 추정되는 알레르기 재료는 **결과에서 제외**한다.\n"
                + "- 즉, 결과에는 오직 \"옵션을 선택함으로써 새로 추가되거나, 옵션에만 고유하게 포함되는\" 알레르기 코드만 포함해야 한다.\n"
                + "- 기본 메뉴의 알레르기는 시스템의 다른 단계에서 이미 처리한다고 가정하라.\n"
                + "\n"
                + "판단 기준:\n"
                + "- 입력으로 주어지는 \"음식명\", \"옵션종류\", \"옵션명\", \"설명\"을 모두 활용하되,\n"
                + "  특히 \"옵션명\"과 \"옵션종류\"를 중심으로 **해당 옵션 자체**에 어떤 재료가 사용될지 추론하라.\n"
                + "- 옵션의 이름이나 설명에 직접 언급된 재료뿐 아니라, 통상적으로 그 옵션에 사용되는 재료도 고려하라.\n"
                + "  (예: 치즈 추가 옵션 → 우유, 햄 추가 옵션 → 돼지고기, 마요 소스 옵션 → 계란, 대두 등)\n"
                + "- 소스, 양념, 토핑, 곁들임, 추가메뉴 등 옵션의 형태에 따라 그 안에 들어갈 수 있는 재료를 최대한 추론하라.\n"
                + "- **기본 음식(메뉴)에 일반적으로 포함되는 재료에 대한 알레르기 코드는 이 함수에서 다시 판단하거나 반환하지 마라.**\n"
                + "  예를 들어, 기본 짜장면에 이미 밀과 대두가 포함된다고 가정한다면,\n"
                + "  단순히 '짜장면'이라는 이유로 밀(5), 대두(4)를 결과에 넣지 않는다.\n"
                + "- 다만, 해당 옵션이 기본 메뉴에 없는 재료를 새로 추가하거나,\n"
                + "  기본 메뉴에는 거의 없다고 보는 재료를 명확히 추가하는 경우에는 그 알레르기 코드를 포함하라.\n"
                + "- 전혀 정보가 없거나 특정 재료를 전혀 추정할 수 없으면 해당 알레르기 코드는 포함하지 않는다.\n"
                + "\n"
                + "입력:\n"
                + "- 시스템은 다음 네 가지 정보를 제공한다.\n"
                + "  • 음식명: 기본 메뉴 이름 (예: 짜장면, 햄버거 등)\n"
                + "  • 옵션종류: 예) 토핑, 소스, 사이드, 추가메뉴 등 옵션 그룹명\n"
                + "  • 옵션명: 실제 선택한 옵션 이름 (예: 치즈 추가, 베이컨 추가 등)\n"
                + "  • 설명: 옵션 또는 메뉴에 대한 추가 설명\n"
                + "- 이 정보를 바탕으로 위 알레르기 코드들 중,\n"
                + "  **해당 옵션을 선택함으로써 추가될 가능성이 높은 코드만** 선택하라.\n"
                + "- 기본 메뉴가 원래 가지고 있을 알레르기(예: 짜장면의 밀/대두, 기본 치즈버거의 우유/밀 등)는\n"
                + "  이 API의 출력에 포함하지 말라.\n"
                + "\n"
                + "출력 형식 (아주 중요):\n"
                + "- 반드시 JSON만 출력하라.\n"
                + "- 구조는 정확히 다음과 같아야 한다.\n"
                + "- {\"allergies\": [번호1, 번호2, ...]}\n"
                + "- 'allergies'는 정수 알레르기 코드의 배열이며, 중복 없이 오름차순 정렬하는 것이 좋다.\n"
                + "- 다른 필드(예: 설명, 메시지, 코멘트, allergen_indices 등)는 절대 추가하지 마라.\n"
                + "- JSON 바깥에 어떤 텍스트도 출력하지 마라.";
    }

    public static String buildInput(String menuName, String groupName, String itemName, String description) {
        return "음식명: " + menuName + "\n"
                + "옵션종류: " + groupName + "\n"
                + "옵션명: "  + itemName + "\n"
                + "설명: " + description + "\n"
                + "알레르기 유발 물질이 해당 음식에 포함됐을 '가능성'을 판단하라.";
    }
}
